<!DOCTYPE html>

<html>

<head>
	<title>E1113: Кубична текстура</title>
	<meta charset="utf-8">

	<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">

	<script type="importmap">
		  {
			"imports": {
			  "three": "https://cdn.jsdelivr.net/npm/three@0.161.0/build/three.module.js",
			  "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.161.0/examples/jsm/",
			  "vax": "https://boytchev.github.io/CourseVAX/lib/vax.js"
			}
		  }
		</script>
</head>

<body>
	<script type="module">

		import * as THREE from "three";
		import { OrbitControls } from "three/addons/controls/OrbitControls.js";
		import { vaxInit, renderer, scene, light, camera } from "vax";

		vaxInit(animate);

		camera.position.set(0, 10, 0);
		camera.lookAt(new THREE.Vector3(0, 10, 10));
		camera.fov = 30;
		camera.updateProjectionMatrix();

		scene.background = new THREE.CubeTextureLoader().load([
			'Storforsen/posx.jpg', 'Storforsen/negx.jpg',
			'Storforsen/posy.jpg', 'Storforsen/negy.jpg',
			'Storforsen/posz.jpg', 'Storforsen/negz.jpg']);
		scene.background.colorSpace = THREE.LinearSRGBColorSpace;

		light.position.set(0, 200, 0);
		var ambientSky = new THREE.AmbientLight("white", 1);
		var ambientForest = new THREE.AmbientLight("darkgreen", 0.5);
		scene.add(ambientSky, ambientForest);

		var invaderMaterial = new THREE.MeshPhysicalMaterial({
			color: "white",
			// transmission: 1,
			roughness: 0,
			ior: 1.5,
			reflectivity: 1,
			thickness: 0.5,
			specularIntensity: 1,
			specularColor: "white"
		});

		var invaderMesh = new THREE.Mesh(new THREE.IcosahedronGeometry(5, 0), invaderMaterial);

		var invaders = [];
		for (var i = 0; i < 5; i++) {
			invaders[i] = invaderMesh.clone();
			invaders[i].position.set(40 * Math.sin((i * 2 * Math.PI) / 5), 10 + 2 * i, 40 * Math.cos((i * 2 * Math.PI) / 5));
			scene.add(invaders[i]);
		}

		window.addEventListener("deviceorientation", deviceOrientation, true);

		function deviceOrientation(event) {
			if (event.gamma > 10) {
				camera.rotation.y = THREE.MathUtils.degToRad(event.alpha);
				camera.rotation.x = THREE.MathUtils.degToRad(-event.gamma + 90 - 180);
			}
			else if (event.gamma < -10) {
				camera.rotation.y = THREE.MathUtils.degToRad(180 + event.alpha);
				camera.rotation.x = THREE.MathUtils.degToRad(-event.gamma - 90 - 180);
			}
		}

		function animate(t) {
			for (var i = 0; i < 5; i++)
				invaders[i].rotation.set(Math.sin(t), Math.sin(t), Math.sin(t));
		}
	</script>
</body>

</html>