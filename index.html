<!DOCTYPE html>

<html>

<head>
	<title>Тест 3: Кристални нападатели</title>
	<meta charset="utf-8">

	<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">

	<script type="importmap">
		  {
			"imports": {
			  "three": "https://cdn.jsdelivr.net/npm/three@0.161.0/build/three.module.js",
			  "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.161.0/examples/jsm/",
			  "vax": "https://boytchev.github.io/CourseVAX/lib/vax.js"
			}
		  }
		</script>
</head>

<body>
	<script type="module">

		// Устройството трябва да е в пейзажен режим, горната му страна да сочи наляво

		import * as THREE from "three";
		import { OrbitControls } from "three/addons/controls/OrbitControls.js";
		import { vaxInit, renderer, scene, light, camera } from "vax";

		vaxInit(animate);

		camera.position.set(0, 10, 0);
		camera.lookAt(new THREE.Vector3(0, 10, 10));
		camera.fov = 40;
		camera.updateProjectionMatrix();

		scene.background = new THREE.CubeTextureLoader().load([
			'Storforsen/posx.jpg', 'Storforsen/negx.jpg',
			'Storforsen/posy.jpg', 'Storforsen/negy.jpg',
			'Storforsen/posz.jpg', 'Storforsen/negz.jpg']);
		scene.background.colorSpace = THREE.LinearSRGBColorSpace;

		light.position.set(0, 100, 0);
		var ambientSky = new THREE.AmbientLight("white", 100);
		var ambientForest = new THREE.AmbientLight("skyblue", 20);
		scene.add(ambientSky, ambientForest);
		

		var invaderMaterial = new THREE.MeshPhysicalMaterial({
			color: 0xffffff,
			transmission: 1,
			opacity: 0.7,
			metalness: 0,
			roughness: 0,
			ior: 1,
			thickness: 5,
			specularIntensity: 1,
			specularColor: 0xffffff,
			lightIntensity: 1,
			exposure: 1,
			side: THREE.DoubleSide,
			transparent: true
		});

		var invaderMesh = new THREE.Mesh(new THREE.IcosahedronGeometry(5, 0), invaderMaterial);

		var invaders = [];
		var n = 14;
		for (var i = 0; i < n; i++) {
			invaders[i] = invaderMesh.clone();
			scene.add(invaders[i]);
		}

		invaders[0].position.set(0, 5, 200);
		invaders[1].position.set(0, 16, -200);
		invaders[2].position.set(-200, 40, 150);
		invaders[3].position.set(-300, 30, 80);
		invaders[4].position.set(-150, 10, -40);
		invaders[5].position.set(-200, 25, -150);
		invaders[6].position.set(300, 25, 150);
		invaders[7].position.set(200, 5, 50);
		invaders[8].position.set(90, 5, 150);
		invaders[9].position.set(-50, 15, -50);
		invaders[10].position.set(100, 5, -30);
		invaders[11].position.set(200, -10, -120);
		invaders[12].position.set(0, 50, -20);
		invaders[13].position.set(50, 50, -120);



		window.addEventListener("deviceorientation", deviceOrientation, true);

		function deviceOrientation(event) {
			if (event.gamma > 0) {
				camera.rotation.y = THREE.MathUtils.degToRad(-event.alpha);
				if(event.gamma > 10)
					camera.rotation.x = THREE.MathUtils.degToRad(180 -event.gamma + 90);
			}
			else if (event.gamma < 0) {
				camera.rotation.y = THREE.MathUtils.degToRad(-180 - event.alpha);
				if(event.gamma < -10);
					camera.rotation.x = THREE.MathUtils.degToRad(180 -event.gamma - 90);
			}
		}

		function animate(t) {
			for (var i = 0; i < n; i++)
				invaders[i].rotation.set(Math.sin(t), Math.cos(t), Math.sin(t));
		}
	</script>
</body>

</html>